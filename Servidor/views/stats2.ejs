<!DOCTYPE html>
<html>
   <head>
   <style>
     
       .opcoes{
           position:relative;
           margin:120px 0px 0px 0px;
           border:10px
       }
   </style>
<title>Stats | Niqq</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    
   
</head>

<body>
<nav id="navBar" class="deep-purple accent-2" role="navigation">
        <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Niqq Stats</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="stats.html">Users</a></li>
               <li><a href='stats2.html'>Stats</a></li>
                <!--<li><a onclick="userLogout()">Logout</a></li>-->
            </ul>
            <ul id="nav-mobile" class="side-nav">
                <li><a href="#users">Users</a></li>
                <!-- <li><a onclick="userLogout()">Logout</a></li>-->
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col m4" style="margin-top: 20px;">
                <select id="opcoes" name="opcoes" style="display:block ! important;">
                    <option value="formsCompared">Comparacao das forms</option>
                    <option value ="fracSignup">Fractioned form</option>
                    <option value ="fill">  Tempo medio para a primeira utilizacao</option>
                </select>
            </div>
        </div>
        <div class="row">
                <div class="col m4">
                    <svg style="padding-left: 20px" ></svg>
                    <div id="render_chart" >
                    </div>
                </div>
            </div>
    </div>
    
    
   <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
     crossorigin="anonymous"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script>
        var apiUrl = "http://127.0.0.1:8080/stats/";
        
        function showSvg(){
            $('canvas').hide();
            $('svg').show();
        }

        function showCanvas(){
            $('svg').hide();
            $('#render_chart').html('');
            $('#render_chart').html('<canvas id="chart" width="500" height="500" ></canvas>');
            $('canvas').show();
        }
        $(function(){
            $('#opcoes').on('change', function () {
                $.get(apiUrl + $('#opcoes').val())
                .done(function(graphData){
                    if($('#opcoes').val() === 'fill'){
                        showSvg();
                        createHistogram(graphData);
                    }else{
                        showCanvas();
                        let context = document.getElementById("chart").getContext('2d');
                        let graph = new Chart(context, graphData);
                        $("chart").html(graph);
                    }
                });
            });
        });

        function createHistogram(data){
            data = [0,0,0,0,0,0,0,0,3,3,3,4,4,4,4, 3,3,3,3,3,3,3,3,3,1,2,3,4,5,5,6,6,7,3,2,2,12];
            var width=500,
                height=500,
                padding=50;

            var histogram = d3.layout.histogram()
                            .bins(3)
                            (data)

            var canvas = d3.select("svg")
            .attr("width",width)
            .attr("height",height+padding);

            var y=d3.scale.linear()
                .domain ([0,d3.max(histogram.map(function (i) {return i.length; }))])
                .range([0,height]);

            var x=d3.scale.linear()
                    .domain([0,d3.max(data)])
                    .range([0,width])

            var xAxis=d3.svg.axis()
                        .scale(x)
                        .orient("bottom");

            var group=canvas.append("g")
                    .attr("transform","translate(0," +height+ ")")
                    .call(xAxis);

            var bars=canvas.selectAll(".bar")
                .data(histogram)
                .enter()
                .append("g")
                .attr("transform","translate(20,0)")

            bars.append("rect")
                .attr("x",function (d) {return x(d.x); })
                .attr("y", function(d) {return 500- y(d.y);})
                .attr("width",function(d) {return d.dx; })
                .attr("height",function(d) {return y(d.y) ;})
                .attr("fill","steelblue");

            bars.append("text")
                .attr("x", function(d) {return x(d.x); })
                .attr("y",function(d) {return 500- y(d.y); })
                .attr("dx",function(d) {return x(d.dx)/2; })
                .attr("dy","20px")      
                .attr("fill","#fff")
                .attr("text-anchor","middle")
                .text(function(d) {return d.y})
        }
    </script>
</body>
</html>